<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Webpage with map</title>
<style>
      html, body, #mapArea {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
<!-- Google maps javascript API -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript">
    //Consider storing kml permalinks in url i.e MapPage/guildford+guildford-district-b-+reading-b-
    var kmls;
    var map;
    var kmlLayerTest;
    var kmlXML;

    function setUpMap() {
        var mapOptions = {
            zoom: 9,
            center: new google.maps.LatLng(51.2, -0.8)
        };
        map = new google.maps.Map(document.getElementById('mapArea'), mapOptions);
        alert("boo");
        setUpKmlArray();
        setUpKML();
    }
    function setUpKML() {
         downloadKml("kmlColourSetter.php?url=https://sturents.com/geo/greenwich-london-boro.kml&col=ffff00ff");
         //getting null error here
         alert(kmlXML.toString());
        //get the first (only) Style tag's first (only) LineStyle tag's first (only) color tag's first (only) child's value
         alert(kmlXML.getElementsByTagName("Style")[0].getElementsByTagName("LineStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue);
        kmlLayerTest = new google.maps.KmlLayer();
        //so far unable pass document on and have it work
        kmlLayerTest.setUrl("kmlColourSetter.php?url=https://sturents.com/geo/greenwich-london-boro.kml&col=ffff00ff");
        alert("done");
    }
    function downloadKml(url) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                kmlXML = xmlhttp.responseXML;
                alert("downloaded");
            }
        }
        xmlhttp.open("GET", url, false);
        xmlhttp.send();
    }
    function setUpKmlArray() {//reading-b-, kingston-upon-thames-london-boro, guildford-district-b-, guildford, surrey-county, surrey
        kmls = new Array(6);
        kmls[0] = new google.maps.KmlLayer();
        kmls[0].setUrl("https://sturents.com/geo/reading-b-.kml");
        kmls[1] = new google.maps.KmlLayer();
        kmls[1].setUrl("https://sturents.com/geo/kingston-upon-thames-london-boro.kml");
        kmls[2] = new google.maps.KmlLayer();
        kmls[2].setUrl("https://sturents.com/geo/guildford-district-b-.kml");
        kmls[3] = new google.maps.KmlLayer();
        kmls[3].setUrl("http://178.62.107.109/testUpload/guildford.kml");
        kmls[4] = new google.maps.KmlLayer();
        kmls[4].setUrl("https://sturents.com/geo/surrey-county.kml");
        kmls[5] = new google.maps.KmlLayer();
        kmls[5].setUrl("https://sturents.com/geo/surrey.kml");
    }
    function test() {
        if (kmlLayerTest.getMap() == map) {
            alert("was map");
            kmlLayerTest.setMap(null);
        } else {
            alert("was null");
            kmlLayerTest.setMap(map);
        }
    }
    //for large numbers of kmls, might want different method - this re-sets the kmls each time
    function toggleKmls() {
        //maybe add code to stop screen jumping to location of last kml that is checked
        for (i = 0; i < 6; i++) {
            if (document.checkboxForm.elements[i].checked) {
                kmls[i].setMap(map);
            } else {
                kmls[i].setMap(null);
            }
        }
    }
    google.maps.event.addDomListener(window, 'load', setUpMap);
</script>
</head>
<body>
<p>
Map will go below when put in.
</p>
<div id="mapArea"></div>
<form name="checkboxForm" action="#" method="get">
<!-- //reading-b-, reading, guildford-district-b-, guildford, surrey-county, surrey -->
<input type="checkbox" name="shape0Checked">reading-b-
<input type="checkbox" name="shape1Checked">kingston-upon-thames-london-boro
<input type="checkbox" name="shape2Checked">guildford-district-b-
<input type="checkbox" name="shape3Checked">guildford
<input type="checkbox" name="shape4Checked">surrey-county
<input type="checkbox" name="shape5Checked">surrey
<input type="button" name="refresh" value="Update map" onclick="toggleKmls(); return false"/>

</form>
<input type="button" onclick="test()" value="No, click ME" />
</body>
</html>