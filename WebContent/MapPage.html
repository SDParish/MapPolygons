<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Webpage with map</title>
<style>
      html, body, #mapArea {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
<!-- Google maps javascript API -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript">
var shapeIndicies=[];//array of Polygons index arrays
var kmlStrings =["caerdydd-cardiff","caerffili-caerphilly","farnham-bourne-ward", "surrey-heath-district-b-","guildford-district-b-","reading-b-","rushmoor-district-b-","east-hampshire-district","epsom-and-ewell-district-b-","hammersmith-and-fulham-london-boro","harrow-london-boro","merton-london-boro","islington-london-boro","kensington-and-chelsea-london-boro","barking-and-dagenham-london-boro","tower-hamlets-london-boro","windsor-and-maidenhead-b-","waltham-forest-london-boro","wandsworth-london-boro","city-and-county-of-the-city-of-london","barnet-london-boro","enfield-london-boro","greenwich-london-boro","hackney-london-boro","haringey-london-boro","hillingdon-london-boro","southwark-london-boro","boston-district-b-"];
var map;
var indicies;
var shapes=[];
var shown;

function setUpMap(){
	var mapOptions = {
		     zoom: 9,
		     center: new google.maps.LatLng(51.2, -0.8)
		  };
	map = new google.maps.Map(document.getElementById('mapArea'), mapOptions);
	setUpShapes();
}
function downloadShape(url){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		setUpShape(xmlhttp.responseXML);
		}
	}
	xmlhttp.open("GET", url, false);
	xmlhttp.send();
}
function setUpShapes(){
	shapes=[];
	fillColor = colors[colors.length-2];
	strokeColor = colors[colors.length-1];
	for(var i=0;i<kmlStrings.length;i++){
		downloadShape("https://sturents.com/geo/"+kmlStrings[i]+".kml");
	}
	shown=false;
}
function setUpShape(kmlData){//Name actually a lie, as once made, a shape's colour is fixed. Could, however, be made to create a shapeOptions that totally defines a shape instead
	var pointsString = kmlData.getElementsByTagName("Polygon")[0].getElementsByTagName("outerBoundaryIs")[0].getElementsByTagName("LinearRing")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;
	var points = pointsString.split('\n');//points[2n] = "". still need to split at ','
	indicies = [];
	var arr;
	for(i=1;i<points.length;i=i+2){
		arr = points[i].split(',');
		indicies[(i-1)/2]= new google.maps.LatLng(arr[1],arr[0]);
	}
	shapeIndicies[shapeIndicies.length] = indicies;
}

function test(){
	if(shown==true){
		for(i=0;i<shapes.length;i++){
			shapes[i].setMap(null);
			shapes[i]=null;
		  }
		  shapes=[];
	  }else{//shapes created here so can set colour
		  for(i=0;i<shapeIndicies.length;i++){
			  shapes[i] = new google.maps.Polygon({
				paths: shapeIndicies[i],
				strokeColor: strokeColor,
				strokeOpacity: 0.8,
				strokeWeight: 3,
				fill: 0.5,
				fillColor: fillColor
				});
			 	shapes[i].setMap(map);
			   shiftHighlightOptions();
		   }
	  }
	  shown=!shown;
}
var col=0;
var colors = ["#000000","#ff0000","#00ff00","#ffff00","#0000ff","#ff00ff","#00ffff","#ffffff","#8f0000","#008f00","#8f8f00","#00008f","#8f008f","#008f8f","#8f8f8f"];
var fillColor;
var strokeColor;
//causes the fill/strokeColor to iterate through various colours
function shiftHighlightOptions(){
	fillColor =strokeColor;
	strokeColor = colors[col];
	col++;
	if(col==colors.length){
		col=0;
	}
}
google.maps.event.addDomListener(window, 'load', setUpMap);
</script>
</head>
<body>
<p>
Map will go below when put in.
</p>
<div id="mapArea"></div>
<input type="button" onclick="test()" value="No, click ME" />
</body>
</html>