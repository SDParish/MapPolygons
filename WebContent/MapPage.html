<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Webpage with map</title>
<style>
      html, body, #mapArea {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
<!-- Polygon drawing javascript based on example at https://developers.google.com/maps/documentation/javascript/examples/polygon-arrays
	Setup to get data from form based on http://www.quirksmode.org/js/formex.html -->
<!-- Google maps javascript API -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript" src="geoxml3.js"></script>
<script type="text/javascript">
//Consider storing kml permalinks in url i.e MapPage/guildford+guildford-district-b-+reading-b-
//surrey, guildford are null, caerffili-.. is not appearing?
var kmlStrings =["caerdydd-cardiff","caerffili-caerphilly","farnham-bourne-ward", "surrey-heath-district-b-","guildford-district-b-","reading-b-","rushmoor-district-b-","east-hampshire-district","epsom-and-ewell-district-b-","hammersmith-and-fulham-london-boro","harrow-london-boro","merton-london-boro","islington-london-boro","kensington-and-chelsea-london-boro","barking-and-dagenham-london-boro","tower-hamlets-london-boro","windsor-and-maidenhead-b-","waltham-forest-london-boro","wandsworth-london-boro","city-and-county-of-the-city-of-london","barnet-london-boro","enfield-london-boro","greenwich-london-boro","hackney-london-boro","haringey-london-boro","hillingdon-london-boro","southwark-london-boro","boston-district-b-"];
var myMap;
var kmlXML;
var geoxml3Parser;
var geoON;

function setUpMap(){
	var mapOptions = {
		     zoom: 9,
		     center: new google.maps.LatLng(51.2, -0.8)
		  };
	myMap = new google.maps.Map(document.getElementById('mapArea'),
		      mapOptions);
	geoxml3Parser = new geoXML3.parser({map: myMap});
	setUpKML();
}
var highlightOptions = {fillColor: "#008f8f", strokeColor: "#8f8f8f", fillOpacity: 0.5, strokeWidth: 10};
//shifts the colour of the given polygon
function testColour(colourNumber){
	geoxml3Parser.docs[colourNumber].placemarks[0].polygon.setOptions(highlightOptions);
	shiftHighlightOptions();
}
var col=0;
var colors = ["#000000","#ff0000","#00ff00","#ffff00","#0000ff","#ff00ff","#00ffff","#ffffff","#8f0000","#008f00","#8f8f00","#00008f","#8f008f","#008f8f","#8f8f8f"]
//causes highlightOptions to iterate through various colours
function shiftHighlightOptions(){
	highlightOptions.fillColor =highlightOptions.strokeColor;
	highlightOptions.strokeColor = colors[col];
	col++;
	if(col==colors.length){
		col=0;
	}
}
//serializeXmlNode based on code from the below address is addded as window.XMLSerializer caused errors on vista IE9 - while (typeof window.XMLSerializer != "undefined") was true, got SCRIPT16386: No such interface supported when tried (new window.XMLSerializer()).serializeToString(xmlNode)
//http://stackoverflow.com/questions/4916327/javascript-replacement-for-xmlserializer-serializetostring
function serializeXmlNode(xmlNode) {
   try {
        return (new window.XMLSerializer()).serializeToString(xmlNode);
    }catch(e){
    	 if (typeof xmlNode.xml != "undefined") {
    		return xmlNode.xml;
    	}
    }
    return "";
}
function setUpKML(){
	for(var i=0;i<kmlStrings.length;i++){
		downloadKml("https://sturents.com/geo/"+kmlStrings[i]+".kml");
		geoxml3Parser.parseKmlString(serializeXmlNode(kmlXML));
	}
	alert("kmlStrings length "+kmlStrings.length+"\n"+"geoxml3Parser.docs length "+geoxml3Parser.docs.length);
	geoON=true;
	alert("setUpKML");
	for(var i=0;i<geoxml3Parser.docs.length;i++){
		if(geoxml3Parser.docs[i].placemarks[0].polygon==null){
			alert("poly "+i);
		}else{
			if(geoxml3Parser.docs[i].placemarks[0].polygon.getOptions ==null){//all are null
				alert("options "+i);
			}
			geoxml3Parser.docs[i].placemarks[0].polygon.setOptions(highlightOptions);
			shiftHighlightOptions();	
		}
	}
}
function downloadKml(url){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		//alert("downloaded");
		kmlXML =xmlhttp.responseXML;
		}
	}
	xmlhttp.open("GET", url, false);
	xmlhttp.send();
}
function test(){
	if(geoON){
		for(var i=kmlStrings.length-1;i>-1;i--){
			geoxml3Parser.hideDocument(geoxml3Parser.docs[i]);
	   }
	}else{
		for(var i=kmlStrings.length-1;i>-1;i--){
			testColour(i);
			geoxml3Parser.showDocument(geoxml3Parser.docs[i]);
		}
	}
	geoON=!geoON;
}
google.maps.event.addDomListener(window, 'load', setUpMap);
</script>
</head>
<body>
<p>
Map will go below when put in.
</p>
<div id="mapArea"></div>
<input type="button" onclick="test()" value="No, click ME" />
<!-- copied from sturents <div class="gmap" data-kml="C:\Users\Stephen\Downloads\oxford.kml"></div> -->
</body>
</html>