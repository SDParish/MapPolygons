<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Webpage with map</title>
<style>
      html, body, #mapArea {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
<!-- Polygon drawing javascript based on example at https://developers.google.com/maps/documentation/javascript/examples/polygon-arrays
	Setup to get data from form based on http://www.quirksmode.org/js/formex.html -->
<!-- Google maps javascript API -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript" src="geoxml3.js"></script>
<script type="text/javascript">
//Consider storing kml permalinks in url i.e MapPage/guildford+guildford-district-b-+reading-b-
var kmls;
var myMap;
var kmlLayerTest;
var kmlXML;
var geoxml3Parser;
var geoON;

function setUpMap(){
	var mapOptions = {
		     zoom: 9,
		     center: new google.maps.LatLng(51.2, -0.8)
		  };
	myMap = new google.maps.Map(document.getElementById('mapArea'),
		      mapOptions);
	geoxml3Parser = new geoXML3.parser({map: myMap});
	setUpKML();
}
/* highlightOptions, the comment in testColour(), and the original testColour() function (from which only poly.polygon.setOptions, and part of the line in test() calling testColour remain) are based on code from: 
 * http://www.geocodezip.com/geoxml3_test/v3_geoxml3_kmltest_linktoB.html?filename=http://www.geocodezip.com/geoxml3_test/wnmapcrm_free_fr_tests_ouest_r_kml.xml
*/
var highlightOptions = [{fillColor: "#FFFF00", strokeColor: "#00ff00", fillOpacity: 0.9, strokeWidth: 10},{fillColor: "#0000ff", strokeColor: "#ff00ff", fillOpacity: 0.9, strokeWidth: 10}];
var col =0;
//toggles the colour of the given polygon - note that as is, implicit that there is only one polygon.
function testColour(poly){
	/*var normalStyle = {//extract style from geoxml entry
	          strokeColor: poly.polygon.get('strokeColor'),
	          strokeWeight: poly.polygon.get('strokeWeight'),
	          strokeOpacity: poly.polygon.get('strokeOpacity'),
	          fillColor: poly.polygon.get('fillColor'),
	          fillOpacity: poly.polygon.get('fillOpacity')
	          };
	alert(normalStyle.strokeColor+"\n"+normalStyle.strokeWeight+"\n"+normalStyle.strokeOpacity+"\n"+normalStyle.fillColor+"\n"+normalStyle.fillOpacity);
	*/
	poly.polygon.setOptions(highlightOptions[col]);
	col = 1-col;
}
function setUpKML(){
	downloadKml("https://sturents.com/geo/farnham-bourne-ward.kml");
	//get the first (only) Style tag's first (only) PolyStyle tag's first (only) color tag's first (only) child's value
	kmlXML.getElementsByTagName("Style")[0].getElementsByTagName("PolyStyle")[0].getElementsByTagName("color")[0].childNodes[0].nodeValue='ff00ff00';
	kmlXML.getElementsByTagName("Style")[0].getElementsByTagName("PolyStyle")[0].getElementsByTagName("fill")[0].childNodes[0].nodeValue='1';
	//above lines change fill color, set fill to be shown
	var string = (new XMLSerializer()).serializeToString(kmlXML);
	geoxml3Parser.parseKmlString(string);
	geoON =true;
	alert("done");
}
function downloadKml(url){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		kmlXML =xmlhttp.responseXML;
		alert("downloaded");
		}
	}
	xmlhttp.open("GET", url, false);
	xmlhttp.send();
}
function test(){
   if(geoON){
	   	testColour(geoxml3Parser.docs[0].placemarks[0]);
		geoxml3Parser.hideDocument(geoxml3Parser.docs[0]);
   }else{
	   geoxml3Parser.showDocument(geoxml3Parser.docs[0]);
   }
   geoON= !geoON;
}
google.maps.event.addDomListener(window, 'load', setUpMap);
</script>
</head>
<body>
<p>
Map will go below when put in.
</p>
<div id="mapArea"></div>
<input type="button" onclick="test()" value="No, click ME" />
<!-- copied from sturents <div class="gmap" data-kml="C:\Users\Stephen\Downloads\oxford.kml"></div> -->
</body>
</html>