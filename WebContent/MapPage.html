<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Webpage with map</title>
<style>
      html, body, #mapArea {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
<!-- Setup to get data from form based on http://www.quirksmode.org/js/formex.html -->
<!-- Google maps javascript API -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
<script type="text/javascript">
//Consider storing kml permalinks in url i.e MapPage/guildford+guildford-district-b-+reading-b-
var kmls;
var kmlsShown;
var map;
var kmlLayerTest;
   
function setUpMap(){
	var mapOptions = {
		     zoom: 9,
		     center: new google.maps.LatLng(51.2, -0.8)
		  };
	map = new google.maps.Map(document.getElementById('mapArea'),
		      mapOptions);
	setUpKML();
	setUpKmlArray();
}
function setUpKML(){
	kmlLayerTest = new google.maps.KmlLayer();
	kmlLayerTest.setUrl("https://sturents.com/geo/farnham-bourne-ward.kml");//Works, but using local copies doesn't
}
function setUpKmlArray(){
	kmls = new Array(6);
	kmlsShown = new Array(6);
	for (i=0;i<6;i++) {
		kmlsShown[i]=false;
	}	
}
function test(){
   if(kmlLayerTest.getMap()==map){
	   kmlLayerTest.setMap(null);
   }else{
	   kmlLayerTest.setMap(map);
   }
}
function toggleKmls(){
	for (i=0;i<6;i++) {
		if(document.checkboxForm.elements[i].checked!=kmlsShown[i]){
			if(kmlsShown[i]){
				//could change to removing the kml from kmls - depends on whether having previously selected it means it may want to be selected again, and the costs of recreation vs storage
				kmls[i].setMap(null);
			}else{
				if(kmls[i]==null){
					kmls[i]= new google.maps.KmlLayer();
					kmls[i].setUrl("https://sturents.com/geo/"+document.checkboxForm.elements[i].name+".kml");
					alert("Created: "+document.checkboxForm.elements[i].name);
				}
				kmls[i].setMap(map);
			}
			kmlsShown[i]=!kmlsShown[i];
	   }
	}	
}

google.maps.event.addDomListener(window, 'load', setUpMap);
</script>
</head>
<body>
<p>
Map will go below when put in.
</p>
<div id="mapArea"></div>
<form name="checkboxForm" action="#" method="get">
<!-- //reading-b-, reading, guildford-district-b-, guildford, surrey-county, surrey -->
<input type="checkbox" name="reading-b-">reading-b-
<input type="checkbox" name="kingston-upon-thames-london-boro">kingston-upon-thames-london-boro
<input type="checkbox" name="guildford-district-b-">guildford-district-b-
<input type="checkbox" name="guildford">guildford
<input type="checkbox" name="surrey-county">surrey-county
<input type="checkbox" name="surrey">surrey
<input type="button" name="refresh" value="Update map" onclick="toggleKmls(); return false"/>

</form>
<input type="button" onclick="test()" value="No, click ME" />
</body>
</html>